<!doctype html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <title>Padiem Modular Dubbing</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="page">
      <aside class="sidebar">
        <h1 class="logo">Padiem · Dubbing</h1>

        <div class="sidebar-group">
          <label class="field-label" for="apiBase">API 기본 URL</label>
          <input id="apiBase" class="field-input" type="text" value="http://localhost:8000" />
        </div>

        <div class="sidebar-group">
          <label class="field-label" for="pollInterval">작업 폴링 간격(초)</label>
          <input id="pollInterval" class="field-input" type="number" min="0.5" max="10" step="0.5" value="1" />
        </div>

        <div class="sidebar-group">
          <label class="field-label" for="maxPolls">최대 폴링 횟수</label>
          <input id="maxPolls" class="field-input" type="number" min="1" max="50" step="1" value="10" />
        </div>

        <p class="sidebar-note">
          비동기 실행 시 <code>/jobs/{{job_id}}</code>에서 상태를 확인하세요.
        </p>
      </aside>

      <main class="main">
        <section class="hero">
          <div class="hero-main">
            <div class="hero-badge">🎧 Padiem RnD · Modular Dubbing</div>
            <h2>Padiem Modular Dubbing</h2>
            <p>모듈식 더빙 파이프라인을 한 화면에서 단계별로 제어합니다.</p>
          </div>
          <div class="hero-meta">
            <div class="meta-label">파이프라인</div>
            <div class="meta-value">Audio → STT → Text → TTS → RVC → Wav2Lip</div>
          </div>
        </section>

        <!-- STEP 1: Audio Extract -->
        <section class="card" id="step-audio">
          <header class="card-header">
            <span class="step-badge">STEP 1</span>
            <div>
              <h3>오디오 추출</h3>
              <p class="card-subtitle">동영상/미디어에서 오디오를 추출합니다.</p>
            </div>
          </header>
          <div class="card-body card-body-grid">
            <div class="card-column">
              <h4>입력 미디어 (영상/음성 파일)</h4>
              <label class="field-label" for="inputMediaPath">입력 미디어 경로</label>
              <input id="inputMediaPath" class="field-input" type="text" value="data/inputs/source.mp4" />
              <label class="field-label" for="outputAudioPath">출력 오디오 경로</label>
              <input id="outputAudioPath" class="field-input" type="text" value="data/runs/source_audio.wav" />
            </div>
            <div class="card-column card-column-border">
              <h4>설정 파일 (선택, YAML)</h4>
              <label class="field-label" for="audioConfigPath">설정 파일 경로</label>
              <input id="audioConfigPath" class="field-input" type="text" placeholder="modules/audio/config.yaml" />
              <label class="checkbox-row">
                <input type="checkbox" id="audioAsync" />
                <span>비동기 실행</span>
              </label>
            </div>
          </div>
          <footer class="card-footer">
            <button id="runAudio" class="primary-btn">오디오 추출 실행</button>
            <div id="audioStatus" class="status-text"></div>
          </footer>
        </section>

        <!-- STEP 2: Whisper STT -->
        <section class="card" id="step-stt">
          <header class="card-header">
            <span class="step-badge">STEP 2</span>
            <div>
              <h3>Whisper STT</h3>
              <p class="card-subtitle">오디오를 텍스트로 전사합니다.</p>
            </div>
          </header>
          <div class="card-body card-body-grid">
            <div class="card-column">
              <label class="field-label" for="sttInputAudio">입력 오디오</label>
              <input id="sttInputAudio" class="field-input" type="text" value="data/runs/source_audio.wav" />
              <label class="field-label" for="sttOutputJson">출력 JSON</label>
              <input id="sttOutputJson" class="field-input" type="text" value="data/runs/stt_result.json" />
            </div>
            <div class="card-column card-column-border">
              <label class="field-label" for="sttConfigPath">설정 파일</label>
              <input id="sttConfigPath" class="field-input" type="text" value="modules/stt_whisper/config/settings.yaml" />
              <p class="caption">언어/워드 타임스탬프 등의 세부 옵션은 YAML에서 직접 수정하세요.</p>
              <label class="checkbox-row">
                <input type="checkbox" id="sttAsync" />
                <span>비동기 실행</span>
              </label>
            </div>
          </div>
          <footer class="card-footer">
            <button id="runSTT" class="primary-btn">STT 실행</button>
            <div id="sttStatus" class="status-text"></div>
          </footer>
        </section>

        <!-- STEP 3: Text Process -->
        <section class="card" id="step-text">
          <header class="card-header">
            <span class="step-badge">STEP 3</span>
            <div>
              <h3>텍스트 처리/번역</h3>
              <p class="card-subtitle">STT 결과를 전처리하거나 번역합니다.</p>
            </div>
          </header>
          <div class="card-body card-body-grid">
            <div class="card-column">
              <label class="field-label" for="textInputJson">입력 JSON</label>
              <input id="textInputJson" class="field-input" type="text" value="data/runs/stt_result.json" />
              <label class="field-label" for="textOutputJson">출력 JSON</label>
              <input id="textOutputJson" class="field-input" type="text" value="data/runs/text_processed.json" />
            </div>
            <div class="card-column card-column-border">
              <label class="field-label" for="textConfigPath">설정 파일</label>
              <input id="textConfigPath" class="field-input" type="text" value="modules/text_processor/config/settings.yaml" />
              <p class="caption">
                원본/번역 언어, 음절 허용치, enforce_timing 등은 설정 파일에서 직접 조정합니다.
              </p>
              <label class="checkbox-row">
                <input type="checkbox" id="textAsync" />
                <span>비동기 실행</span>
              </label>
            </div>
          </div>
          <footer class="card-footer">
            <button id="runText" class="primary-btn">텍스트 처리 실행</button>
            <div id="textStatus" class="status-text"></div>
          </footer>
        </section>

        <!-- STEP 4: VALL-E X TTS -->
        <section class="card" id="step-tts">
          <header class="card-header">
            <span class="step-badge">STEP 4</span>
            <div>
              <h3>VALL-E X 합성</h3>
              <p class="card-subtitle">전처리된 텍스트로 음성을 합성합니다.</p>
            </div>
          </header>
          <div class="card-body card-body-grid">
            <div class="card-column">
              <label class="field-label" for="ttsInputJson">입력 JSON</label>
              <input id="ttsInputJson" class="field-input" type="text" value="data/runs/text_processed.json" />
              <label class="field-label" for="ttsOutputAudio">출력 WAV</label>
              <input id="ttsOutputAudio" class="field-input" type="text" value="data/runs/tts_output.wav" />
            </div>
            <div class="card-column card-column-border">
              <label class="field-label" for="ttsConfigPath">설정 파일 (선택)</label>
              <input id="ttsConfigPath" class="field-input" type="text" placeholder="modules/tts/config.yaml" />
              <label class="checkbox-row">
                <input type="checkbox" id="ttsAsync" />
                <span>비동기 실행</span>
              </label>
            </div>
          </div>
          <footer class="card-footer">
            <button id="runTTS" class="primary-btn">VALL-E X 실행</button>
            <div id="ttsStatus" class="status-text"></div>
          </footer>
        </section>

        <!-- STEP 5: XTTS Backup -->
        <section class="card" id="step-xtts">
          <header class="card-header">
            <span class="step-badge">STEP 5</span>
            <div>
              <h3>XTTS 백업 합성</h3>
              <p class="card-subtitle">백업 경로로 음성을 합성합니다.</p>
            </div>
          </header>
          <div class="card-body card-body-grid">
            <div class="card-column">
              <label class="field-label" for="xttsInputJson">입력 JSON</label>
              <input id="xttsInputJson" class="field-input" type="text" value="data/runs/text_processed.json" />
              <label class="field-label" for="xttsOutputAudio">출력 WAV</label>
              <input id="xttsOutputAudio" class="field-input" type="text" value="data/runs/xtts_output.wav" />
            </div>
            <div class="card-column card-column-border">
              <label class="field-label" for="xttsConfigPath">설정 파일 (선택)</label>
              <input id="xttsConfigPath" class="field-input" type="text" placeholder="modules/xtts/config.yaml" />
              <label class="checkbox-row">
                <input type="checkbox" id="xttsAsync" />
                <span>비동기 실행</span>
              </label>
            </div>
          </div>
          <footer class="card-footer">
            <button id="runXTTS" class="primary-btn">XTTS 실행</button>
            <div id="xttsStatus" class="status-text"></div>
          </footer>
        </section>

        <!-- STEP 6: RVC -->
        <section class="card" id="step-rvc">
          <header class="card-header">
            <span class="step-badge">STEP 6</span>
            <div>
              <h3>RVC 음성 변환</h3>
              <p class="card-subtitle">합성 음성을 타깃 화자의 음색으로 바꿉니다.</p>
            </div>
          </header>
          <div class="card-body card-body-grid">
            <div class="card-column">
              <label class="field-label" for="rvcInputAudio">입력 WAV</label>
              <input id="rvcInputAudio" class="field-input" type="text" value="data/runs/tts_output.wav" />
              <label class="field-label" for="rvcOutputAudio">출력 WAV</label>
              <input id="rvcOutputAudio" class="field-input" type="text" value="data/runs/rvc_output.wav" />
            </div>
            <div class="card-column card-column-border">
              <label class="field-label" for="rvcConfigPath">설정 파일 (선택)</label>
              <input id="rvcConfigPath" class="field-input" type="text" placeholder="modules/rvc/config.yaml" />
              <label class="checkbox-row">
                <input type="checkbox" id="rvcAsync" />
                <span>비동기 실행</span>
              </label>
            </div>
          </div>
          <footer class="card-footer">
            <button id="runRVC" class="primary-btn">RVC 실행</button>
            <div id="rvcStatus" class="status-text"></div>
          </footer>
        </section>

        <!-- STEP 7: Wav2Lip -->
        <section class="card" id="step-lipsync">
          <header class="card-header">
            <span class="step-badge">STEP 7</span>
            <div>
              <h3>Wav2Lip 립싱크</h3>
              <p class="card-subtitle">변환된 음성으로 영상 립싱크를 합성합니다.</p>
            </div>
          </header>
          <div class="card-body card-body-grid">
            <div class="card-column">
              <label class="field-label" for="lipsyncInputVideo">입력 영상</label>
              <input id="lipsyncInputVideo" class="field-input" type="text" value="data/inputs/source.mp4" />
              <label class="field-label" for="lipsyncInputAudio">입력 오디오</label>
              <input id="lipsyncInputAudio" class="field-input" type="text" value="data/runs/rvc_output.wav" />
              <label class="field-label" for="lipsyncOutputVideo">출력 영상</label>
              <input id="lipsyncOutputVideo" class="field-input" type="text" value="data/runs/final_dubbed.mp4" />
            </div>
            <div class="card-column card-column-border">
              <label class="field-label" for="lipsyncConfigPath">설정 파일 (선택)</label>
              <input id="lipsyncConfigPath" class="field-input" type="text" placeholder="modules/lipsync/config.yaml" />
              <label class="checkbox-row">
                <input type="checkbox" id="lipsyncAsync" />
                <span>비동기 실행</span>
              </label>
            </div>
          </div>
          <footer class="card-footer">
            <button id="runLipsync" class="primary-btn">Wav2Lip 실행</button>
            <div id="lipsyncStatus" class="status-text"></div>
          </footer>
        </section>

        <!-- STEP 8: Full Pipeline -->
        <section class="card" id="step-pipeline">
          <header class="card-header">
            <span class="step-badge">STEP 8</span>
            <div>
              <h3>전체 파이프라인 실행</h3>
              <p class="card-subtitle">오디오 추출부터 립싱크까지 순차 실행합니다.</p>
            </div>
          </header>
          <div class="card-body card-body-grid">
            <div class="card-column">
              <label class="field-label" for="pipelineInput">입력 미디어 경로</label>
              <input id="pipelineInput" class="field-input" type="text" value="data/inputs/source.mp4" />
              <label class="field-label" for="pipelineRunDir">실행 폴더</label>
              <input id="pipelineRunDir" class="field-input" type="text" value="data/runs/source" />
            </div>
            <div class="card-column card-column-border">
              <p class="caption">
                각 단계는 현재 카드에서 입력한 경로를 그대로 사용합니다. 실행 중 오류가 발생하면 즉시 중단됩니다.
              </p>
            </div>
          </div>
          <footer class="card-footer">
            <button id="runPipeline" class="primary-btn">전체 파이프라인 실행</button>
            <div id="pipelineStatus" class="status-text"></div>
          </footer>
        </section>

        <section class="card">
          <header class="card-header">
            <h3>응답 / 로그</h3>
          </header>
          <pre id="log" class="log-viewer"></pre>
        </section>
      </main>
    </div>

    <script src="main.js" type="module"></script>
  </body>
</html>
