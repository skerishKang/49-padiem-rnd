<!doctype html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Padiem Modular Dubbing · Web Console</title>
    <link rel="stylesheet" href="styles.css?v=20241118" />
  </head>
  <body>
    <div class="page">
      <aside class="sidebar">
        <h1 class="logo">Padiem · Dubbing</h1>

        <label class="field-label" for="apiBase">API 기본 URL</label>
        <input id="apiBase" class="field-input" type="text" value="http://localhost:8000" />

        <label class="field-label" for="pollInterval">폴링 간격(초)</label>
        <input id="pollInterval" class="field-input" type="number" min="0.5" max="10" step="0.5" value="1" />

        <label class="field-label" for="maxPolls">최대 폴링 횟수</label>
        <input id="maxPolls" class="field-input" type="number" min="1" max="50" step="1" value="10" />

        <p class="sidebar-note">
          비동기 실행 시 <code>/jobs/&lt;job_id&gt;</code>에서 상태를 확인합니다.
          모든 요청은 FastAPI 백엔드(JSON API)에 직접 전달됩니다.
        </p>
      </aside>

      <main class="main">
        <section class="hero">
          <div class="hero-main">
            <div class="hero-badge">🎧 Padiem RnD</div>
            <h2>Padiem Modular Dubbing</h2>
            <p>모듈식 더빙 파이프라인을 단일 페이지에서 단계별로 제어하세요.</p>
          </div>
          <div class="hero-meta">
            <div class="meta-label">파이프라인</div>
            <div class="meta-value">Audio → STT → Text → TTS → RVC → Wav2Lip</div>
          </div>
        </section>

        <datalist id="videoPresets">
          <option value="data/inputs/source.mp4"></option>
          <option value="data/inputs/sample.mp4"></option>
          <option value="data/inputs/demo.mov"></option>
        </datalist>
        <datalist id="audioPresets">
          <option value="data/runs/source_audio.wav"></option>
          <option value="data/runs/tts_output.wav"></option>
          <option value="data/runs/xtts_output.wav"></option>
          <option value="data/runs/rvc_output.wav"></option>
        </datalist>
        <datalist id="jsonPresets">
          <option value="data/runs/stt_result.json"></option>
          <option value="data/runs/text_processed.json"></option>
          <option value="data/intermediates/stt_result.json"></option>
        </datalist>
        <datalist id="configPresets">
          <option value="modules/audio_extractor/config.yaml"></option>
          <option value="modules/stt_whisper/config/settings.yaml"></option>
          <option value="modules/text_processor/config/settings.yaml"></option>
          <option value="modules/tts/config.yaml"></option>
          <option value="modules/xtts/config.yaml"></option>
          <option value="modules/rvc/config.yaml"></option>
          <option value="modules/lipsync/config.yaml"></option>
        </datalist>

        <div id="steps">
          <section class="card" id="step-audio">
            <header class="card-header">
              <span class="step-badge">STEP 1</span>
              <div>
                <h3>오디오 추출</h3>
                <p class="card-subtitle">동영상/음성에서 오디오를 추출합니다.</p>
              </div>
            </header>
            <div class="card-body grid">
              <div>
                <label class="field-label" for="audioInputMedia">입력 미디어 경로</label>
                <div class="field-with-presets">
                  <input id="audioInputMedia" class="field-input" type="text" list="videoPresets" value="data/inputs/source.mp4" />
                  <div class="preset-panel" data-target="audioInputMedia" data-preset="videoPresets"></div>
                </div>

                <label class="field-label" for="audioOutputPath">출력 오디오 경로</label>
                <div class="field-with-presets">
                  <input id="audioOutputPath" class="field-input" type="text" list="audioPresets" value="data/runs/source_audio.wav" />
                  <div class="preset-panel" data-target="audioOutputPath" data-preset="audioPresets"></div>
                </div>

                <div class="media-preview is-hidden" id="audioOutputPreviewWrapper">
                  <div class="media-preview-head">
                    <strong>출력 오디오 미리듣기</strong>
                    <button type="button" class="ghost-btn" id="refreshAudioPreview">새로고침</button>
                  </div>
                  <audio id="audioOutputPreview" controls preload="none"></audio>
                  <p class="caption" id="audioPreviewStatus">출력 경로가 설정되면 미리듣기를 사용할 수 있습니다.</p>
                </div>
              </div>
              <div>
                <label class="field-label" for="audioConfigPath">설정 파일 경로 (선택)</label>
                <div class="field-with-presets">
                  <input id="audioConfigPath" class="field-input" type="text" list="configPresets" placeholder="modules/audio_extractor/config.yaml" />
                  <div class="preset-panel" data-target="audioConfigPath" data-preset="configPresets"></div>
                </div>

                <label class="checkbox-row">
                  <input type="checkbox" id="audioAsync" />
                  <span>비동기 실행</span>
                </label>
              </div>
            </div>
            <footer class="card-footer">
              <button class="primary-btn" id="runAudio">오디오 추출 실행</button>
              <div class="status-text" id="audioStatus"></div>
            </footer>
          </section>

          <section class="card" id="step-stt">
            <header class="card-header">
              <span class="step-badge">STEP 2</span>
              <div>
                <h3>Whisper STT</h3>
                <p class="card-subtitle">오디오를 텍스트로 전사합니다.</p>
              </div>
            </header>
            <div class="card-body grid">
              <div>
                <label class="field-label" for="sttInputAudio">입력 오디오 경로</label>
                <div class="field-with-presets">
                  <input id="sttInputAudio" class="field-input" type="text" list="audioPresets" value="data/runs/source_audio.wav" />
                  <div class="preset-panel" data-target="sttInputAudio" data-preset="audioPresets"></div>
                </div>

                <label class="field-label" for="sttOutputJson">결과 JSON 경로</label>
                <div class="field-with-presets">
                  <input id="sttOutputJson" class="field-input" type="text" list="jsonPresets" value="data/runs/stt_result.json" />
                  <div class="preset-panel" data-target="sttOutputJson" data-preset="jsonPresets"></div>
                </div>
              </div>
              <div>
                <label class="field-label" for="sttConfigPath">설정 파일 경로</label>
                <div class="field-with-presets">
                  <input id="sttConfigPath" class="field-input" type="text" list="configPresets" value="modules/stt_whisper/config/settings.yaml" />
                  <div class="preset-panel" data-target="sttConfigPath" data-preset="configPresets"></div>
                </div>

                <label class="checkbox-row">
                  <input type="checkbox" id="sttAsync" />
                  <span>비동기 실행</span>
                </label>
              </div>
            </div>
            <footer class="card-footer">
              <button class="primary-btn" id="runStt">STT 실행</button>
              <div class="status-text" id="sttStatus"></div>
            </footer>
          </section>

          <section class="card" id="step-text">
            <header class="card-header">
              <span class="step-badge">STEP 3</span>
              <div>
                <h3>텍스트 처리/번역</h3>
                <p class="card-subtitle">STT 결과를 전처리하고 번역합니다.</p>
              </div>
            </header>
            <div class="card-body grid">
              <div>
                <label class="field-label" for="textInputJson">입력 JSON 경로</label>
                <div class="field-with-presets">
                  <input id="textInputJson" class="field-input" type="text" list="jsonPresets" value="data/runs/stt_result.json" />
                  <div class="preset-panel" data-target="textInputJson" data-preset="jsonPresets"></div>
                </div>

                <label class="field-label" for="textOutputJson">출력 JSON 경로</label>
                <div class="field-with-presets">
                  <input id="textOutputJson" class="field-input" type="text" list="jsonPresets" value="data/runs/text_processed.json" />
                  <div class="preset-panel" data-target="textOutputJson" data-preset="jsonPresets"></div>
                </div>
              </div>
              <div>
                <label class="field-label" for="textConfigPath">설정 파일 경로</label>
                <div class="field-with-presets">
                  <input id="textConfigPath" class="field-input" type="text" list="configPresets" value="modules/text_processor/config/settings.yaml" />
                  <div class="preset-panel" data-target="textConfigPath" data-preset="configPresets"></div>
                </div>

                <div class="field-group">
                  <div>
                    <label class="field-label" for="textSourceLang">원본 언어</label>
                    <select id="textSourceLang" class="field-input">
                      <option value="ko">한국어</option>
                      <option value="en" selected>영어</option>
                      <option value="ja">일본어</option>
                      <option value="zh">중국어</option>
                      <option value="fr">프랑스어</option>
                      <option value="es">스페인어</option>
                      <option value="de">독일어</option>
                      <option value="ru">러시아어</option>
                    </select>
                  </div>
                  <div>
                    <label class="field-label" for="textTargetLang">번역 언어</label>
                    <select id="textTargetLang" class="field-input">
                      <option value="en">영어</option>
                      <option value="ko" selected>한국어</option>
                      <option value="ja">일본어</option>
                      <option value="zh">중국어</option>
                      <option value="fr">프랑스어</option>
                      <option value="es">스페인어</option>
                      <option value="de">독일어</option>
                      <option value="ru">러시아어</option>
                    </select>
                  </div>
                </div>

                <label class="checkbox-row">
                  <input type="checkbox" id="textAsync" />
                  <span>비동기 실행</span>
                </label>
              </div>
            </div>
            <footer class="card-footer">
              <button class="primary-btn" id="runText">텍스트 처리 실행</button>
              <div class="status-text" id="textStatus"></div>
            </footer>
          </section>

          <section class="card" id="step-tts">
            <header class="card-header">
              <span class="step-badge">STEP 4</span>
              <div>
                <h3>VALL-E X 합성</h3>
                <p class="card-subtitle">전처리된 텍스트를 음성으로 합성합니다.</p>
              </div>
            </header>
            <div class="card-body grid">
              <div>
                <label class="field-label" for="ttsInputJson">입력 JSON 경로</label>
                <div class="field-with-presets">
                  <input id="ttsInputJson" class="field-input" type="text" list="jsonPresets" value="data/runs/text_processed.json" />
                  <div class="preset-panel" data-target="ttsInputJson" data-preset="jsonPresets"></div>
                </div>

                <label class="field-label" for="ttsOutputAudio">출력 WAV 경로</label>
                <div class="field-with-presets">
                  <input id="ttsOutputAudio" class="field-input" type="text" list="audioPresets" value="data/runs/tts_output.wav" />
                  <div class="preset-panel" data-target="ttsOutputAudio" data-preset="audioPresets"></div>
                </div>
              </div>
              <div>
                <label class="field-label" for="ttsConfigPath">설정 파일 경로 (선택)</label>
                <div class="field-with-presets">
                  <input id="ttsConfigPath" class="field-input" type="text" list="configPresets" placeholder="modules/tts/config.yaml" />
                  <div class="preset-panel" data-target="ttsConfigPath" data-preset="configPresets"></div>
                </div>

                <label class="checkbox-row">
                  <input type="checkbox" id="ttsAsync" />
                  <span>비동기 실행</span>
                </label>
              </div>
            </div>
            <footer class="card-footer">
              <button class="primary-btn" id="runTts">VALL-E X 실행</button>
              <div class="status-text" id="ttsStatus"></div>
            </footer>
          </section>

          <section class="card" id="step-xtts">
            <header class="card-header">
              <span class="step-badge">STEP 5</span>
              <div>
                <h3>XTTS 백업 합성</h3>
                <p class="card-subtitle">백업 경로로 음성을 합성합니다.</p>
              </div>
            </header>
            <div class="card-body grid">
              <div>
                <label class="field-label" for="xttsInputJson">입력 JSON 경로</label>
                <div class="field-with-presets">
                  <input id="xttsInputJson" class="field-input" type="text" list="jsonPresets" value="data/runs/text_processed.json" />
                  <div class="preset-panel" data-target="xttsInputJson" data-preset="jsonPresets"></div>
                </div>

                <label class="field-label" for="xttsOutputAudio">출력 WAV 경로</label>
                <div class="field-with-presets">
                  <input id="xttsOutputAudio" class="field-input" type="text" list="audioPresets" value="data/runs/xtts_output.wav" />
                  <div class="preset-panel" data-target="xttsOutputAudio" data-preset="audioPresets"></div>
                </div>
              </div>
              <div>
                <label class="field-label" for="xttsConfigPath">설정 파일 경로 (선택)</label>
                <div class="field-with-presets">
                  <input id="xttsConfigPath" class="field-input" type="text" list="configPresets" placeholder="modules/xtts/config.yaml" />
                  <div class="preset-panel" data-target="xttsConfigPath" data-preset="configPresets"></div>
                </div>

                <label class="checkbox-row">
                  <input type="checkbox" id="xttsAsync" />
                  <span>비동기 실행</span>
                </label>
              </div>
            </div>
            <footer class="card-footer">
              <button class="primary-btn" id="runXtts">XTTS 실행</button>
              <div class="status-text" id="xttsStatus"></div>
            </footer>
          </section>

          <section class="card" id="step-rvc">
            <header class="card-header">
              <span class="step-badge">STEP 6</span>
              <div>
                <h3>RVC 음성 변환</h3>
                <p class="card-subtitle">합성 음성을 타깃 화자의 음색으로 변환합니다.</p>
              </div>
            </header>
            <div class="card-body grid">
              <div>
                <label class="field-label" for="rvcInputAudio">입력 WAV 경로</label>
                <div class="field-with-presets">
                  <input id="rvcInputAudio" class="field-input" type="text" list="audioPresets" value="data/runs/tts_output.wav" />
                  <div class="preset-panel" data-target="rvcInputAudio" data-preset="audioPresets"></div>
                </div>

                <label class="field-label" for="rvcOutputAudio">출력 WAV 경로</label>
                <div class="field-with-presets">
                  <input id="rvcOutputAudio" class="field-input" type="text" list="audioPresets" value="data/runs/rvc_output.wav" />
                  <div class="preset-panel" data-target="rvcOutputAudio" data-preset="audioPresets"></div>
                </div>
              </div>
              <div>
                <label class="field-label" for="rvcConfigPath">설정 파일 경로 (선택)</label>
                <div class="field-with-presets">
                  <input id="rvcConfigPath" class="field-input" type="text" list="configPresets" placeholder="modules/rvc/config.yaml" />
                  <div class="preset-panel" data-target="rvcConfigPath" data-preset="configPresets"></div>
                </div>

                <label class="checkbox-row">
                  <input type="checkbox" id="rvcAsync" />
                  <span>비동기 실행</span>
                </label>
              </div>
            </div>
            <footer class="card-footer">
              <button class="primary-btn" id="runRvc">RVC 실행</button>
              <div class="status-text" id="rvcStatus"></div>
            </footer>
          </section>

          <section class="card" id="step-lipsync">
            <header class="card-header">
              <span class="step-badge">STEP 7</span>
              <div>
                <h3>Wav2Lip 립싱크</h3>
                <p class="card-subtitle">변환된 음성을 영상에 립싱크합니다.</p>
              </div>
            </header>
            <div class="card-body grid">
              <div>
                <label class="field-label" for="lipsyncInputVideo">입력 영상 경로</label>
                <div class="field-with-presets">
                  <input id="lipsyncInputVideo" class="field-input" type="text" list="videoPresets" value="data/inputs/source.mp4" />
                  <div class="preset-panel" data-target="lipsyncInputVideo" data-preset="videoPresets"></div>
                </div>

                <label class="field-label" for="lipsyncInputAudio">입력 오디오 경로</label>
                <div class="field-with-presets">
                  <input id="lipsyncInputAudio" class="field-input" type="text" list="audioPresets" value="data/runs/rvc_output.wav" />
                  <div class="preset-panel" data-target="lipsyncInputAudio" data-preset="audioPresets"></div>
                </div>

                <label class="field-label" for="lipsyncOutputVideo">출력 영상 경로</label>
                <div class="field-with-presets">
                  <input id="lipsyncOutputVideo" class="field-input" type="text" list="videoPresets" value="data/runs/final_dubbed.mp4" />
                  <div class="preset-panel" data-target="lipsyncOutputVideo" data-preset="videoPresets"></div>
                </div>
              </div>
              <div>
                <label class="field-label" for="lipsyncConfigPath">설정 파일 경로 (선택)</label>
                <div class="field-with-presets">
                  <input id="lipsyncConfigPath" class="field-input" type="text" list="configPresets" placeholder="modules/lipsync/config.yaml" />
                  <div class="preset-panel" data-target="lipsyncConfigPath" data-preset="configPresets"></div>
                </div>

                <label class="checkbox-row">
                  <input type="checkbox" id="lipsyncAsync" />
                  <span>비동기 실행</span>
                </label>
              </div>
            </div>
            <footer class="card-footer">
              <button class="primary-btn" id="runLipsync">Wav2Lip 실행</button>
              <div class="status-text" id="lipsyncStatus"></div>
            </footer>
          </section>

          <section class="card" id="step-pipeline">
            <header class="card-header">
              <span class="step-badge">STEP 8</span>
              <div>
                <h3>전체 파이프라인 실행</h3>
                <p class="card-subtitle">위 설정을 그대로 사용해 전체 흐름을 순차 실행합니다.</p>
              </div>
            </header>
            <div class="card-body grid">
              <div>
                <label class="field-label" for="pipelineInput">입력 미디어 경로</label>
                <div class="field-with-presets">
                  <input id="pipelineInput" class="field-input" type="text" list="videoPresets" value="data/inputs/source.mp4" />
                  <div class="preset-panel" data-target="pipelineInput" data-preset="videoPresets"></div>
                </div>
              </div>
              <div>
                <p class="caption">
                  각 단계는 위 카드에서 지정한 경로/설정을 사용합니다. 실행 중 오류가 발생하면 즉시 중단됩니다.
                </p>
              </div>
            </div>
            <footer class="card-footer">
              <button class="primary-btn" id="runPipeline">전체 파이프라인 실행</button>
              <div class="status-text" id="pipelineStatus"></div>
            </footer>
          </section>
        </div>

        <section class="card">
          <header class="card-header">
            <h3>응답 / 로그</h3>
          </header>
          <pre id="log" class="log-viewer"></pre>
        </section>
      </main>
    </div>

    <script src="main.js?v=20241118" type="module"></script>
  </body>
</html>
