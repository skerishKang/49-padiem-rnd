---
📅 **날짜**: 2025년 7월 23일 (수)
👤 **작성자**: 강철원 (연구책임자) | **승인**: 강혜림 (대표)
📊 **진행 단계**: 3단계 - 고도화 및 사업화
🎯 **주요 작업**: 구독 관리 DB 설계
---

# AI 기반 다국어 음성 합성 및 실시간 립싱크 더빙 시스템 개발일지

## 📋 오늘의 작업 내용

### 1. DB 스키마 설계

- **Subscriptions**: 사용자 ID, 플랜 ID, 상태(Active, Canceled, PastDue), 시작일, 종료일, 다음 결제일.
- **PaymentHistory**: 결제 ID, 사용자 ID, 금액, 통화, 결제 수단, 상태, 영수증 URL.
- **Credits**: 사용자 ID, 잔여 크레딧, 만료일.

### 2. 상태 전이 로직

- 결제 성공 -> Active & 크레딧 충전.
- 결제 실패 -> PastDue (유예 기간 3일).
- 구독 취소 -> Canceled (기간 만료 시까지 유지).

## 🔧 기술적 진행사항

### SQLAlchemy 모델

```python
class Subscription(Base):
    __tablename__ = "subscriptions"
    id = Column(Integer, primary_key=True)
    user_id = Column(Integer, ForeignKey("users.id"))
    plan_id = Column(String) # starter, pro
    status = Column(String) # active, canceled
    current_period_end = Column(DateTime)
```

## 📊 진행 상황

| 항목 | 계획 | 실제 | 상태 |
|------|------|------|------|
| DB 설계 | 완료 | 완료 | ✅ |
| 로직 정의 | 완료 | 완료 | ✅ |

## 🚧 이슈 사항 및 해결 방안

- **업그레이드/다운그레이드**: 도중에 플랜 변경 시 차액 계산(Proration). -> 복잡하므로 초기에는 '즉시 변경 및 남은 기간 크레딧 환불' 정책으로 단순화.

## 📝 내일 계획

1. 결제 페이지 UI 개발
2. PortOne 정기 결제 연동 테스트

---

## 📚 참고 자료

- [1] "SaaS Billing Logic". [Link](https://stripe.com/docs/billing/subscriptions/prorations)

<details>
<summary>IRIS 붙여넣기용 HTML 코드</summary>

```html
<h3>1. DB 스키마 설계</h3>
<ul>
<li><strong>Subscriptions</strong>: 사용자 ID, 플랜 ID, 상태(Active, Canceled, PastDue), 시작일, 종료일, 다음 결제일.</li>
<li><strong>PaymentHistory</strong>: 결제 ID, 사용자 ID, 금액, 통화, 결제 수단, 상태, 영수증 URL.</li>
<li><strong>Credits</strong>: 사용자 ID, 잔여 크레딧, 만료일.</li>
</ul>
<h3>2. 상태 전이 로직</h3>
<ul>
<li>결제 성공 -&gt; Active &amp; 크레딧 충전.</li>
<li>결제 실패 -&gt; PastDue (유예 기간 3일).</li>
<li>구독 취소 -&gt; Canceled (기간 만료 시까지 유지).</li>
</ul>
```

</details>
