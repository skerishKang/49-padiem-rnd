---
ğŸ“… **ë‚ ì§œ**: 2025ë…„ 7ì›” 28ì¼ (ì›”)
ğŸ‘¤ **ì‘ì„±ì**: ê°•ì² ì› (ì—°êµ¬ì±…ì„ì) | **ìŠ¹ì¸**: ê°•í˜œë¦¼ (ëŒ€í‘œ)
ğŸ“Š **ì§„í–‰ ë‹¨ê³„**: 3ë‹¨ê³„ - ê³ ë„í™” ë° ì‚¬ì—…í™”
ğŸ¯ **ì£¼ìš” ì‘ì—…**: ìŠ¤ì¼€ì¤„ëŸ¬ êµ¬í˜„ (ìë™ ê²°ì œ)
---

# AI ê¸°ë°˜ ë‹¤êµ­ì–´ ìŒì„± í•©ì„± ë° ì‹¤ì‹œê°„ ë¦½ì‹±í¬ ë”ë¹™ ì‹œìŠ¤í…œ ê°œë°œì¼ì§€

## ğŸ“‹ ì˜¤ëŠ˜ì˜ ì‘ì—… ë‚´ìš©

### 1. ìŠ¤ì¼€ì¤„ëŸ¬ ì„¤ì •

- **ë„êµ¬**: `APScheduler` (Advanced Python Scheduler).
- **ì£¼ê¸°**: ë§¤ì¼ ìì •(00:00) ì‹¤í–‰.
- **ë¡œì§**:
  1. `subscriptions` í…Œì´ë¸”ì—ì„œ `status='active'`ì´ê³  `current_period_end`ê°€ ì˜¤ëŠ˜ì¸ í•­ëª© ì¡°íšŒ.
  2. í•´ë‹¹ ì‚¬ìš©ìì˜ `billing_key`ë¡œ PortOne ê²°ì œ ìš”ì²­.
  3. ì„±ê³µ ì‹œ `current_period_end`ë¥¼ í•œ ë‹¬ ë’¤ë¡œ ê°±ì‹ í•˜ê³  í¬ë ˆë”§ ì¶©ì „.
  4. ì‹¤íŒ¨ ì‹œ `status='past_due'`ë¡œ ë³€ê²½í•˜ê³  ì•Œë¦¼ ë©”ì¼ ë°œì†¡.

## ğŸ”§ ê¸°ìˆ ì  ì§„í–‰ì‚¬í•­

### APScheduler Job

```python
scheduler.add_job(
    process_recurring_payments,
    'cron',
    hour=0,
    minute=0,
    id='recurring_payment_job'
)
```

## ğŸ“Š ì§„í–‰ ìƒí™©

| í•­ëª© | ê³„íš | ì‹¤ì œ | ìƒíƒœ |
|------|------|------|------|
| ìŠ¤ì¼€ì¤„ëŸ¬ ì„¤ì • | ì™„ë£Œ | ì™„ë£Œ | âœ… |
| ê²°ì œ ë¡œì§ êµ¬í˜„ | ì™„ë£Œ | ì™„ë£Œ | âœ… |

## ğŸš§ ì´ìŠˆ ì‚¬í•­ ë° í•´ê²° ë°©ì•ˆ

- **ì¤‘ë³µ ê²°ì œ**: ìŠ¤ì¼€ì¤„ëŸ¬ê°€ ì¤‘ë³µ ì‹¤í–‰ë  ìœ„í—˜. -> Redisë¥¼ ì´ìš©í•œ ë¶„ì‚° ë½(Distributed Lock) ì ìš©í•˜ì—¬ í•œ ë²ˆë§Œ ì‹¤í–‰ë˜ë„ë¡ ë³´ì¥.

## ğŸ“ ë‚´ì¼ ê³„íš

1. ê²°ì œ ì‹¤íŒ¨ ì‹œ ì¬ì‹œë„(Retry) ë¡œì§
2. í¬ë ˆë”§ ì°¨ê° ì‹œìŠ¤í…œ ì—°ë™

---

## ğŸ“š ì°¸ê³  ìë£Œ

- [1] "APScheduler Documentation". [Link](https://apscheduler.readthedocs.io/)

<details>
<summary>IRIS ë¶™ì—¬ë„£ê¸°ìš© HTML ì½”ë“œ</summary>

```html
<h3>1. ìŠ¤ì¼€ì¤„ëŸ¬ ì„¤ì •</h3>
<ul>
<li><strong>ë„êµ¬</strong>: <code>APScheduler</code> (Advanced Python Scheduler).</li>
<li><strong>ì£¼ê¸°</strong>: ë§¤ì¼ ìì •(00:00) ì‹¤í–‰.</li>
<li><strong>ë¡œì§</strong>:
<ol>
<li><code>subscriptions</code> í…Œì´ë¸”ì—ì„œ <code>status='active'</code>ì´ê³  <code>current_period_end</code>ê°€ ì˜¤ëŠ˜ì¸ í•­ëª© ì¡°íšŒ.</li>
<li>í•´ë‹¹ ì‚¬ìš©ìì˜ <code>billing_key</code>ë¡œ PortOne ê²°ì œ ìš”ì²­.</li>
<li>ì„±ê³µ ì‹œ <code>current_period_end</code>ë¥¼ í•œ ë‹¬ ë’¤ë¡œ ê°±ì‹ í•˜ê³  í¬ë ˆë”§ ì¶©ì „.</li>
<li>ì‹¤íŒ¨ ì‹œ <code>status='past_due'</code>ë¡œ ë³€ê²½í•˜ê³  ì•Œë¦¼ ë©”ì¼ ë°œì†¡.</li>
</ol>
</li>
</ul>
<h3>2. ìŠ¤ì¼€ì¤„ëŸ¬ ì„¤ì •</h3>
<ul>
<li><strong>ë„êµ¬</strong>: <code>APScheduler</code> (Advanced Python Scheduler).</li>
<li><strong>ì£¼ê¸°</strong>: ë§¤ì¼ ìì •(00:00) ì‹¤í–‰.</li>
</ul>
```

</details>
