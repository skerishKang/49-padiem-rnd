# 연구노트 (책임자 관점)

- **날짜**: 2024-10-10
- **작성자**: 강혜림
- **역할**: 책임연구원
- **진행 단계**: 1단계 기초연구·설계
- **아젠다**: 자막 입력 모듈 구조, 메타데이터 스키마, 품질검증 시나리오 정리

---

## 1. 연구 배경·목적 정리 (책임 관점)

- 전체 서비스 아키텍처 중 **"자막 입력 계층(subtitle ingest)"** 의 책임과 범위를 오늘 명확히 했다.
- IRIS 연구계획서 PART2에 나와 있는 "입력 모듈 세부 설계" 요구사항을 실제 구현 가능한 수준으로 쪼개어, 이후 모듈 개발·테스트·IRIS 보고서에 그대로 연결될 수 있도록 구조화하는 것이 핵심 목표다.
- 특히, 한글/다국어 자막(SRT, VTT, ASS)을 모두 받아서 **일관된 내부 표현과 메타데이터로 정규화**하는 것이 이후 RVC/TTS/Wav2Lip 등 AI 모듈과 QC 모듈을 연결하는 출발점이므로, 책임자 관점에서 품질·확장성·추적 가능성을 모두 고려해야 하는 단계였다.

---

## 2. 오늘 진행 내용 (세부)

### 2.1 자막 포맷 통합 설계
- Python 기반 `subtitle-ingest` 패키지 구조를 확정하고, SRT / WebVTT / ASS 각각에 대해
  - 어떤 라이브러리를 쓸지
  - 자막 블록을 내부 공통 구조(시작/끝 시간, 텍스트, 스타일 정보 등)로 어떻게 매핑할지
  를 정의했다.
- 인코딩(UTF-8/UTF-16, BOM 여부) 자동 감지, 언어 태그 추출, 중복 라인 제거 규칙까지 1차 설계 완료.
- 책임자 관점에서, 이 단계에서 **포맷/인코딩 이슈로 인한 장애를 최대한 앞단에서 잡아내는 전략**으로 방향을 고정했다.

### 2.2 처리 규칙 정의
- 타임코드 해상도(밀리초 단위), 비언어 정보(예: [웃음], [음악]) 처리 방식, 사용자 로그에 남길 필드들을 정리했다.
- 이후 맞춤법·문장부호·언어교정 도구(LanguageTool 등)와 연계할 수 있도록, 교정 전/후 텍스트를 모두 추적 가능하게 설계했다.

### 2.3 메타데이터 스키마(subtitle_metadata_v0.2)
- `language`, `speaker_id`, `confidence`, `timeline_offset`, `quality_flag` 등 12개 필드로 구성된 v0.2 스키마를 정의했다.
- 이 스키마는 이후 DB ERD(특히 `subtitle_segments` 테이블)와 QC 리포트, IRIS 최종보고서 내 지표 산출에 공통으로 쓰이도록 설계했다.
- 책임자 입장에서, 메타데이터 설계가 **추후 리허설/최종보고 단계의 추적성·재현성**을 좌우하므로, 되도록 범용적으로 잡으면서도 이번 과제 범위를 벗어나지 않도록 선을 그었다.

### 2.4 품질검증(QC) 시나리오 초안
- 자막 겹침/누락/과도한 길이 등 8가지 예외 케이스를 정의하고, 각 케이스를 재현할 수 있는 테스트 시나리오를 작성했다.
- pytest 기반 테스트 코드(`tests/subtitle_ingest/test_parsers.py`)와 연계될 수 있게, 시나리오 ID와 기대 결과를 명시적으로 남기기로 했다.

---

## 3. 책임자 관점 의사결정·리스크

- **결정 1: 자막 포맷 지원 범위**
  - 당장은 SRT/VTT/ASS 3종에 집중하고, 기타 포맷은 후순위로 두기로 결정.
  - IRIS 요구사항과 실제 현장 사용 빈도를 고려했을 때, 이 3종만으로도 1단계 목표는 충분히 커버된다고 판단.

- **결정 2: 메타데이터 버전 관리 전략**
  - `subtitle_metadata_v0.2`를 기준으로 개발을 진행하되, 10월 말까지는 소규모 변경(v0.3까지)은 허용, 11월부터는 큰 필드 변경 없이 backward compatible 개선만 허용하기로 합의.

- **리스크 1: ASS 포맷 복잡도**
  - 원본 문서에서도 언급된 것처럼 ASS 스펙이 복잡해, 기존 파서가 놓치는 케이스가 많다.
  - → **대응**: FFmpeg `ass` 필터를 이용한 중간 JSON 변환 스크립트를 보조로 두고, 10월 중에 최소 1차 안정화까지 가져가는 것을 목표로 설정.

- **리스크 2: 다국어 자막 처리 범위**
  - 언어 태그/문자셋 처리에서 중국어·일본어 특수 기호 등 edge case가 추후에 터질 가능성이 높다.
  - → **대응**: 오늘은 기본 스키마/로직에 집중하고, 10/15 자막 스트레스 테스트와 연계해 케이스를 수집한 뒤, 10월 말에 한 번에 반영하는 일정으로 계획.

---

## 4. 지표·산출물 정리

- **설계 문서·다이어그램**
  - 자막 입력 모듈 설계 문서 8p, 시퀀스 다이어그램 2장 초안.
- **코드/스크립트**
  - `subtitle-ingest` 초기 구조 및 포맷 파서 스켈레톤 작성.
- **품질지표(초안)**
  - 자막 파서 정합률(포맷별), 타임코드 정확도, 비언어 정보 처리율 등을 KPI 후보로 선정.
  - 실제 수치는 10/15 테스트 이후부터 채우기로 함.

---

## 5. 다음 액션 (책임 관점 To-do)

1. **10/11 ~ 10/15**
   - AI 모듈 파라미터 설계 회의(10/11)에서 자막 메타데이터 필드를 어떻게 활용할지 논의.
   - 10/15 자막 스트레스 테스트(CI/CD 연계)에서 파서 정합률·에러 패턴 수집.

2. **10/14 ~ 10/21**
   - 출력/QC 모듈 설계(10/14)와 연계하여, 자막 메타데이터가 QC 리포트와 어떻게 연결되는지 정의.

3. **10월 말(10/29 ~ 10/31)**
   - IRIS 문서 교정 단계에서, 오늘 정의한 메타데이터/포맷 용어를 공식 용어로 고정하고, 보고서/체크리스트/콘솔 UI에 동일하게 반영.

---

## 6. 참고 문서·링크

- IRIS 연구계획서 PART2 (입력 모듈)
  - `@pdf/ocr/과제접수연구개발계획서(PART2(본문1))_ocr.pdf`
- 자막 ingest 설계 및 스키마
  - `codex/src/subtitle_ingest/ingest_pipeline.py`
  - `codex/schemas/subtitle_metadata_v0_2.json`
  - `codex/tests/subtitle_ingest/test_parsers.py`

> 메모: 이 노트는 2024-10-10 원본 연구노트의 기술적 내용을 바탕으로, 책임연구원 입장에서 설계 방향·리스크·KPI 관점으로 재구성한 기록이다. 향후 CI/CD 및 IRIS 최종보고서에 맞게 일부 용어와 지표는 추가 조정 예정.