# 연구노트 (책임자 관점)

- **날짜**: 2024-10-15
- **작성자**: 강혜림
- **역할**: 책임연구원
- **진행 단계**: 1단계 기초연구·설계
- **아젠다**: 자막 스트레스 테스트, 자동 테스트(CI) 연계, 품질지표 초기 측정

---

## 1. 연구 배경·목적 정리 (책임 관점)

- 10/10에 설계한 자막 입력 모듈과 10/14에 정의한 출력·QC 프레임워크가 실제 **현실적인 자막 데이터셋에서 어느 정도 동작하는지** 검증하는 날.
- 목표는
  - 다양한 도메인(방송/교육/게임)과 언어(ko/en/ja/zh)에 대해
  - 자막 파서·정규화 로직이 얼마나 견고한지,
  - 자동 테스트(CI)로 어느 수준까지 품질을 잡아낼 수 있는지 확인하는 것이다.

---

## 2. 오늘 진행 내용 (세부)

### 2.1 테스트 데이터셋 구성
- 방송·교육·게임 3개 도메인에서 총 45개 자막 파일(SRT/VTT/ASS)을 수집.
- 각 자막에 대해 메타데이터(도메인, 언어, 길이, 화자 수 등)를 정리해, 이후 통계 분석이 가능하도록 구성.

### 2.2 자동 테스트 환경 구축
- `tests/test_subtitle_ingest.py`를 작성하고, pytest 기반의 단위 테스트 구조를 구성.
- GitHub Actions 워크플로우에 자막 스트레스 테스트를 통합하여, PR/메인 브랜치 기준으로 자동 검증되도록 설정.
- CI 로그에서 자막 누락률, 타임코드 정합률, BOM 감지 실패 등을 자동으로 요약해 보여줄 수 있도록 출력 포맷을 맞춤.

### 2.3 품질 측정 결과(초기)
- 전체 65개 테스트 케이스 중 63개 성공 (정합률 96.9%).
- 립싱용 자막 싱크 테스트에서 평균 오차 1.2초 수준으로 개선(기존 1.5초).
- CI 파이프라인 실행 시간은 평균 3분 40초.

### 2.4 버그 수정
- ASS 스타일 태그 파싱 오류를 FFmpeg `ass` 필터 기반 중간 변환 모듈을 도입해 해결.
- 중국어 자막에서 BOM 처리 실패 문제를 ICU 라이브러리로 교체하여 해결.

---

## 3. 책임자 관점 의사결정·리스크

- **결정 1: CI에 포함할 범위**
  - 자막 파서·정규화·기본 QC까지는 CI에 포함시키고, GPU 리소스가 많이 드는 딥러닝 모듈 테스트는 별도 주간 리포트에서 다루기로 함.

- **결정 2: 품질 기준선 설정**
  - 자막 누락률 0.1% 이하, 타임코드 정합률 99% 목표를 기준선으로 잡고, 오늘 수치를 레퍼런스로 사용.

- **리스크 1: ICU 라이브러리 의존성 증가**
  - 컨테이너 이미지 사이즈 증가 및 배포 속도 저하 위험.
  - → **대응**: Alpine 기반 slim 패키지를 도입해 이미지 용량을 180MB → 130MB 수준으로 줄이는 방향을 10/22까지 검토.

- **리스크 2: 테스트 케이스 커버리지**
  - 현재는 45개 파일·65개 케이스 수준으로, 엣지 케이스에 대한 커버리지가 아직 부족.
  - → **대응**: 11월 이후 실제 IRIS 제출 직전 리허설 데이터에서 추가 케이스를 수집해 보완.

---

## 4. 지표·산출물 정리

- **자동 테스트**
  - `tests/test_subtitle_ingest.py` 작성 및 GitHub Actions 연동.
- **품질 수치(초기 레퍼런스)**
  - 정합률 96.9%, 싱크 오차 1.2초, CI 실행 시간 3분 40초.

---

## 5. 다음 액션 (책임 관점 To-do)

1. **10/16 GPU 최적화 실험 연계**
   - 자막 입력·출력 단계의 병목과 GPU 측 추론 병목을 함께 고려해 전체 파이프라인 최적화 방향을 잡을 것.

2. **10/18 orchestrator 통합 테스트**
   - 오늘 구축한 CI 테스트를 orchestrator end-to-end 테스트의 일부로 편입하여, 실제 서비스 흐름에서도 동일한 품질 검증이 이루어지도록 할 것.

---

## 6. 참고 문서·링크

- 자막 테스트 관련 가이드
  - Netflix Timed Text Style Guide, 2023.
  - ICU User Guide, 2024.
- 내부 자막 테스트 코드·워크플로우
  - `tests/test_subtitle_ingest.py`
  - GitHub Actions 워크플로우 (원본 노트 참고).

> 메모: 이 노트는 2024-10-15 원본 연구노트의 자막 스트레스 테스트 및 CI 연동 내용을 책임자 입장에서 재구성한 것이다. 이후 10월 말 KPI 정리와 IRIS 품질 챕터에 자막 품질 지표를 넣을 때 기준선으로 사용할 예정이다.