# 연구노트 (책임자 관점)

- **날짜**: 2024-10-23
- **작성자**: 강혜림
- **역할**: 책임연구원
- **진행 단계**: 1단계 기초연구·설계
- **ਅ젠다**: chunked inference 하이브리드 모드 튜닝, 프로파일링 기반 성능 최적화

---

## 1. 연구 배경·목적 정리 (책임 관점)

- 10/21에 도입한 chunked inference 로직은 long clip 안정성에는 효과적이지만, 전체 처리 시간이 증가하는 단점이 있었다.
- 오늘의 목적은
  - clip 길이에 따라 **single-pass vs chunk 모드**를 선택하는 하이브리드 전략을 설계하고,
  - NVIDIA Nsight·PyTorch profiler를 활용해 병목 구간을 정밀 분석하여, IRIS 보고서에 제시할 수 있는 "최적 운용 전략"을 도출하는 것.

---

## 2. 오늘 진행 내용 (세부)

### 2.1 하이브리드 모드 설계
- clip 길이 30초를 기준으로 분기:
  - 30초 이하: 기존 single-pass inference 경로 사용.
  - 30초 초과: chunk 모드로 전환.
- 분기 임계값(28~35초)을 여러 값으로 실험해본 결과, 32초 근방에서 성능·안정성이 가장 좋은 것으로 확인.

### 2.2 성능 프로파일링
- NVIDIA Nsight Systems와 PyTorch profiler를 이용해
  - single vs chunk 모드에서의 GPU SM 사용률,
  - I/O 대기 시간,
  - CPU/GPU 간 동기화 지연 등을 분석.
- chunk 모드에서 I/O 대기 시간이 증가하는 구간을 확인하고, prefetch 스레드를 추가해 완화.

### 2.3 벤치마크 결과
- 10~90초 사이 20개 clip에 대해 벤치마크.
- 하이브리드 모드 적용 후 평균 처리 시간 약 7분 35초, 메모리 사용량 39GB 수준으로 유지.
- long clip 실패율은 0%, overall throughput은 chunk-only 대비 소폭 개선.

### 2.4 자동 리포트 업데이트
- `benchmark_runner.py`에 하이브리드 모드 결과를 비교할 수 있는 기능 추가.
- Slack으로 주간 성능 리포트를 자동 전송하도록 설정.

---

## 3. 책임자 관점 의사결정·리스크

- **결정 1: 하이브리드 모드 공식 채택**
  - IRIS 제출 전까지는 30초 기준 하이브리드 전략을 기본 운용 모드로 채택.

- **리스크 1: 임계값에 따른 품질 편차**
  - 임계값(예: 32초)을 조정하면 품질·성능이 미세하게 바뀔 수 있음.
  - → **대응**: 11월 초까지 실사용 데이터 기반으로 추가 통계를 축적한 후, 최종 IRIS 보고서에는 당시 기준값과 근거를 함께 명시.

---

## 4. 지표·산출물 정리

- **성능 지표**
  - 평균 처리 시간: 7분 35초.
  - 메모리 사용량: 39GB.
  - 실패율: 0% (테스트 20건 기준).
- **도구**
  - `benchmark_runner.py` 하이브리드 모드 비교 기능.

---

## 5. 다음 액션 (책임 관점 To-do)

1. **10/24 IRIS 중간점검 리허설**
   - 하이브리드 모드 설정을 기준으로 데모·리허설을 진행.

2. **10/25 사용자 테스트 2차와 연계**
   - 실제 사용자 테스트에서 처리 시간·안정성에 대한 피드백을 수집해, 임계값 조정 여부를 검토.

---

## 6. 참고 문서·링크

- NVIDIA Efficient Multi-Stream Inference, 2024.
- PyTorch Profiler Guide, 2024.
- IRIS 연구계획서 PART2(성능 지표 기준값).

> 메모: 이 노트는 2024-10-23 원본 연구노트의 chunk 하이브리드 튜닝 내용을 책임자 관점에서 정리한 것이다. IRIS 중간점검 리허설과 2차 사용자 테스트 시 성능 설명 근거로 사용된다.